# =============================================================================
# iTel Cabinet API Connection Configuration
# =============================================================================
# HTTP connection configuration for iTel Cabinet API integration.
# Used by itel_cabinet_api_worker to send task data to iTel systems.
#
# Status: PLACEHOLDER - Update with actual iTel API details when available
#
# Required Environment Variables:
#   - ITEL_CABINET_API_BASE_URL: iTel Cabinet API base URL
#   - ITEL_CABINET_API_TOKEN: Authentication token (or API key)
#
# Related Files:
#   - config/plugins/itel_cabinet_api/workers.yaml - Worker using this connection
#   - kafka_pipeline/plugins/itel_cabinet_api/handlers/itel_api_sender.py - Handler implementation
# =============================================================================

connection:
  # ===========================================================================
  # iTel Cabinet API Connection
  # ===========================================================================
  # Main connection for sending task tracking data to iTel Cabinet systems.
  #
  # TODO: Update with actual iTel API details:
  #   - Base URL
  #   - Authentication type (bearer, api_key, basic)
  #   - Specific endpoint paths
  #   - Required headers
  #   - Rate limits / timeouts
  # ===========================================================================
  itel_cabinet_api:
    name: itel_cabinet_api

    # Base URL - PLACEHOLDER
    # Update with actual iTel Cabinet API endpoint
    base_url: ${ITEL_CABINET_API_BASE_URL}  # e.g., https://api.itelcabinet.com

    # Authentication - PLACEHOLDER
    # Options: bearer, api_key, basic, none
    # Update based on iTel's authentication method
    auth_type: bearer  # or api_key, basic depending on iTel requirements
    auth_token: ${ITEL_CABINET_API_TOKEN}

    # Optional: Custom auth header (if not using standard Authorization header)
    # auth_header: X-API-Key  # Uncomment if iTel uses custom header

    # Timeouts and Retries
    timeout_seconds: 45                # iTel API might be slower than ClaimX
    max_retries: 3                     # Retry failed requests
    retry_backoff_base: 2              # Exponential backoff
    retry_backoff_max: 90              # Max 90 seconds between retries

    # Custom Headers - PLACEHOLDER
    # Update with any required headers for iTel API
    headers:
      User-Agent: ClaimXPipeline-iTel/1.0
      Accept: application/json
      Content-Type: application/json
      # X-Client-ID: claimx-integration  # Example custom header
      # X-API-Version: v1                # Example version header

# =============================================================================
# Configuration Notes
# =============================================================================
#
# Environment Variable Setup:
#   Before starting the iTel API worker, set these variables:
#
#   export ITEL_CABINET_API_BASE_URL="https://api.itelcabinet.com"
#   export ITEL_CABINET_API_TOKEN="your-itel-api-token-here"
#
# Authentication Types:
#   - bearer: Authorization: Bearer <token>
#   - api_key: X-API-Key: <token> (or custom header via auth_header)
#   - basic: Authorization: Basic <base64(user:pass)>
#   - none: No authentication
#
# Testing Connection:
#   Use ConnectionManager to test before deploying:
#
#   from kafka_pipeline.plugins.connections import ConnectionManager
#   manager = ConnectionManager()
#   # Load connection from this file
#   await manager.start()
#   response = await manager.request("itel_cabinet_api", "GET", "/health")
#
# Rate Limiting:
#   If iTel API has rate limits:
#   - Adjust timeout_seconds if responses are slow
#   - Configure worker batch_size to control request rate
#   - Consider adding delay between requests in handler
#
# Error Handling:
#   - 4xx errors: Typically not retried (client error)
#   - 5xx errors: Automatically retried with exponential backoff
#   - Network errors: Automatically retried
#   - Failed messages sent to error topic for investigation
#
# Endpoints (PLACEHOLDER):
#   Common iTel Cabinet API endpoints (update with actual paths):
#   - POST /api/v1/tasks - Create/update task
#   - POST /api/v1/tasks/{task_id}/status - Update task status
#   - POST /api/v1/repairs - Submit repair form data
#   - GET /api/v1/tasks/{task_id} - Get task details
#
# Security:
#   - Never commit API tokens to version control
#   - Rotate tokens regularly
#   - Use HTTPS only (base_url must start with https://)
#   - Minimum required permissions on token
#   - Monitor for unauthorized access in iTel logs
#
# =============================================================================

# =============================================================================
# Example API Request
# =============================================================================
# Once configured, the worker will make requests like:
#
# POST https://api.itelcabinet.com/api/v1/tasks
# Authorization: Bearer <token>
# Content-Type: application/json
#
# {
#   "task_id": 32513,
#   "assignment_id": 12345,
#   "project_id": "ABC-123",
#   "status": "completed",
#   "completed_at": "2026-01-10T12:34:56Z",
#   "repair_details": { ... },
#   "claimx_data": { ... }
# }
#
# Expected Response:
# 200 OK
# {
#   "success": true,
#   "itel_task_id": "ITEL-67890",
#   "message": "Task received"
# }
# =============================================================================
