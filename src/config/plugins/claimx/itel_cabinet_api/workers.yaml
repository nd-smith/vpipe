# =============================================================================
# iTel Cabinet Workers Configuration
# =============================================================================
# Simple, clear configuration - no handler framework magic.
#
# Two workers process iTel cabinet events:
# 1. Tracking worker - Enriches and writes to Delta
# 2. API worker - Transforms and sends to iTel API
#
# Architecture:
#   Plugin → Kafka (pcesdopodappv1-itel-cabinet-pending)
#                ↓
#        ┌───────┴────────┐
#        ↓                ↓
#   Tracking Worker   API Worker
#   (Delta Table)     (iTel API)
# =============================================================================

workers:
  # ===========================================================================
  # iTel Cabinet Tracking Worker
  # ===========================================================================
  # Processes task events, enriches COMPLETED tasks, writes to Delta tables.
  #
  # Startup:
  #   python -m pipeline.plugins.itel_cabinet_api.itel_cabinet_tracking_worker
  # ===========================================================================
  itel_cabinet_tracking:
    # Processing settings
    processing:
      health_port: 8096
      health_enabled: true

    # Transport settings (Event Hub or Kafka)
    transport:
      input_topic: pcesdopodappv1-itel-cabinet-pending
      consumer_group: itel_cabinet_tracking_group

    # Delta table paths (supports ${VAR} and ${VAR:-default} env var syntax)
    delta_tables:
      submissions_path: ${ITEL_DELTA_FORMS_TABLE:-}
      attachments_path: ${ITEL_DELTA_ATTACHMENTS_TABLE:-}

    # Pipeline configuration
    pipeline:
      claimx_connection: claimx_api
      output_topic: pcesdopodappv1-itel-cabinet-completed

  # ===========================================================================
  # iTel Cabinet API Worker
  # ===========================================================================
  # Consumes completed tasks from tracking worker and sends to iTel API.
  #
  # Startup (dev mode by default, writes to files):
  #   python -m pipeline.plugins.itel_cabinet_api.itel_cabinet_api_worker
  #
  # Production Mode (sends to iTel API):
  #   python -m pipeline.plugins.itel_cabinet_api.itel_cabinet_api_worker --prod
  # ===========================================================================
  itel_cabinet_api:
    # Processing settings
    processing:
      health_port: 8097
      health_enabled: true

    # Transport settings (Event Hub or Kafka)
    transport:
      input_topic: pcesdopodappv1-itel-cabinet-completed
      consumer_group: itel_cabinet_api_group

    # iTel API settings
    api:
      connection: itel_cabinet_api
      endpoint: /api/v1/cabinet/repairs
      method: POST

      # Vendor-required identity fields (injected into API payload)
      carrier_id: ${ITEL_CABINET_API_CARRIER_ID}
      subscription_id: ${ITEL_CABINET_API_SUBSCRIPTION_ID}

      # Test mode - controlled by --prod flag (dev mode is default)
      test_mode: false

# =============================================================================
# Environment Variables Required
# =============================================================================
# ClaimX API connection
# export CLAIMX_API_URL="https://www.claimxperience.com/service/cxedirest"
# export CLAIMX_API_TOKEN="your-claimx-basic-token"
#
# iTel API connection (required for API worker)
# export ITEL_CABINET_API_BASE_URL="https://api.qa.itelinc.net/cabinet-repair-orv"
# export ITEL_CABINET_API_CLIENT_ID="your-client-id"
# export ITEL_CABINET_API_CLIENT_CREDENTIAL="your-client-credential"
# export ITEL_CABINET_API_TOKEN_URL="https://login.microsoftonline.com/<tenant-id>/oauth2/v2.0/token"
# export ITEL_CABINET_API_SCOPE="your-scope"
# export ITEL_CABINET_API_CARRIER_ID="your-carrier-guid"
# export ITEL_CABINET_API_SUBSCRIPTION_ID="your-subscription-id"
#
# Kafka connection
# export KAFKA_BOOTSTRAP_SERVERS="localhost:9094"
#
# Delta tables (tracking worker) - can also be set directly in delta_tables config above
# export ITEL_DELTA_FORMS_TABLE="abfss://workspace@onelake.dfs.fabric.microsoft.com/lakehouse/Tables/claimx_itel_forms"
# export ITEL_DELTA_ATTACHMENTS_TABLE="abfss://workspace@onelake.dfs.fabric.microsoft.com/lakehouse/Tables/claimx_itel_attachments"
# =============================================================================
