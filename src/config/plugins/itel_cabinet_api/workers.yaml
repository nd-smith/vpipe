# =============================================================================
# iTel Cabinet Workers Configuration
# =============================================================================
# Simple, clear configuration - no handler framework magic.
#
# Two workers process iTel cabinet events:
# 1. Tracking worker - Enriches and writes to Delta
# 2. API worker - Transforms and sends to iTel API
#
# Architecture:
#   Plugin → Kafka (itel.cabinet.task.tracking)
#                ↓
#        ┌───────┴────────┐
#        ↓                ↓
#   Tracking Worker   API Worker
#   (Delta Table)     (iTel API)
# =============================================================================

workers:
  # ===========================================================================
  # iTel Cabinet Tracking Worker
  # ===========================================================================
  # Processes task events, enriches COMPLETED tasks, writes to Delta tables.
  #
  # Startup:
  #   python -m kafka_pipeline.plugins.itel_cabinet_api.itel_cabinet_tracking_worker
  # ===========================================================================
  itel_cabinet_tracking:
    # Kafka settings
    kafka:
      input_topic: itel.cabinet.task.tracking
      consumer_group: itel_cabinet_tracking_group

    # Delta tables (table names, full paths constructed by worker)
    delta_tables:
      submissions: claimx_itel_forms
      attachments: claimx_itel_attachments

    # Pipeline configuration
    pipeline:
      claimx_connection: claimx_api
      output_topic: itel.cabinet.completed
      download_media: true  # Download media files and upload to OneLake (requires ITEL_ATTACHMENTS_PATH)

  # ===========================================================================
  # iTel Cabinet API Worker
  # ===========================================================================
  # Consumes completed tasks from tracking worker and sends to iTel API.
  #
  # Startup:
  #   python -m kafka_pipeline.plugins.itel_cabinet_api.itel_cabinet_api_worker
  #
  # Dev Mode (writes to files instead of API):
  #   python -m kafka_pipeline.plugins.itel_cabinet_api.itel_cabinet_api_worker --dev
  # ===========================================================================
  itel_cabinet_api:
    # Kafka settings
    kafka:
      input_topic: itel.cabinet.completed
      consumer_group: itel_cabinet_api_group

    # iTel API settings
    api:
      connection: itel_cabinet_api
      endpoint: /api/v1/cabinet/repairs
      method: POST

      # Test mode - write to files instead of calling API
      test_mode: true
      test_output_dir: config/plugins/itel_cabinet_api/test

# =============================================================================
# Environment Variables Required
# =============================================================================
# ClaimX API connection
# export CLAIMX_API_BASE_PATH="https://www.claimxperience.com/service/cxedirest"
# export CLAIMX_API_TOKEN="your-claimx-basic-token"
#
# iTel API connection (required for API worker)
# export ITEL_CABINET_API_BASE_URL="https://api.itelcabinet.com"
# export ITEL_CABINET_API_TOKEN="your-itel-token"
#
# Kafka connection
# export KAFKA_BOOTSTRAP_SERVERS="localhost:9094"
#
# Delta tables (tracking worker)
# export ITEL_DELTA_FORMS_TABLE="abfss://workspace@onelake.dfs.fabric.microsoft.com/lakehouse/Tables/claimx_itel_forms"
# export ITEL_DELTA_ATTACHMENTS_TABLE="abfss://workspace@onelake.dfs.fabric.microsoft.com/lakehouse/Tables/claimx_itel_attachments"
#
# OneLake attachments storage (optional - required if download_media=true)
# export ITEL_ATTACHMENTS_PATH="abfss://7729c159-0674-42ba-abf7-a6756723c62f@onelake.dfs.fabric.microsoft.com/584315ee-2f41-4943-949f-901d438bcd36/Files/veriskPipeline/itel_cabinet_form/attachments"
# =============================================================================
