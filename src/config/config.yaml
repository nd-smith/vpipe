# Minimal VPipe Configuration for Simulation Mode
# This file provides defaults for workers running in simulation mode
# Environment variables will override these settings

# Event source type (eventhub or eventhouse)
event_source: ${EVENT_SOURCE:-eventhub}

# Kafka configuration
kafka:
  connection:
    bootstrap_servers: ${KAFKA_BOOTSTRAP_SERVERS:-kafka:9092}
    security_protocol: ${KAFKA_SECURITY_PROTOCOL:-PLAINTEXT}

  consumer_defaults:
    auto_offset_reset: earliest
    enable_auto_commit: false
    max_poll_records: 100

  producer_defaults:
    acks: "1"
    compression_type: "lz4"

  # XACT domain configuration
  xact:
    topics:
      events: "xact.events.raw"
      events_ingested: "xact.events.ingested"
      enrichment_pending: "xact.enrichment.pending"
      downloads_pending: "xact.downloads.pending"
      downloads_cached: "xact.downloads.cached"
      downloads_results: "xact.downloads.results"
      dlq: "xact.downloads.dlq"

    consumer_group_prefix: "xact"
    retry_delays: [10, 20, 40, 80]  # Shorter delays for simulation (10s, 20s, 40s, 80s)
    max_retries: 4

  # ClaimX domain configuration
  claimx:
    topics:
      events: "claimx.events.raw"
      enrichment_pending: "claimx.enrichment.pending"
      entities_rows: "claimx.entities.rows"
      downloads_pending: "claimx.downloads.pending"
      downloads_cached: "claimx.downloads.cached"
      downloads_results: "claimx.downloads.results"
      dlq: "claimx.downloads.dlq"

    consumer_group_prefix: "claimx"
    retry_delays: [10, 20, 40, 80]  # Shorter delays for simulation (10s, 20s, 40s, 80s)
    max_retries: 4

# Delta Lake configuration
delta:
  enable_writes: true

  # XACT domain delta tables
  # Env vars: XACT_EVENTS_TABLE_PATH, XACT_DELTA_EVENTS_TABLE (or legacy DELTA_EVENTS_TABLE_PATH)
  xact:
    events_table_path: ""  # XACT_EVENTS_TABLE_PATH or XACT_DELTA_EVENTS_TABLE
    inventory_table_path: ""  # XACT_INVENTORY_TABLE_PATH or XACT_DELTA_INVENTORY_TABLE
    failed_table_path: ""  # XACT_FAILED_TABLE_PATH or XACT_DELTA_FAILED_TABLE

  # ClaimX domain delta tables
  # Env vars: CLAIMX_*_TABLE_PATH or CLAIMX_DELTA_*_TABLE patterns both supported
  claimx:
    events_table_path: ""  # CLAIMX_EVENTS_TABLE_PATH or CLAIMX_DELTA_EVENTS_TABLE
    inventory_table_path: ""  # CLAIMX_INVENTORY_TABLE_PATH or CLAIMX_DELTA_INVENTORY_TABLE
    failed_table_path: ""
    projects_table_path: ""  # CLAIMX_PROJECTS_TABLE_PATH or CLAIMX_DELTA_PROJECTS_TABLE
    contacts_table_path: ""  # CLAIMX_CONTACTS_TABLE_PATH or CLAIMX_DELTA_CONTACTS_TABLE
    media_table_path: ""  # CLAIMX_MEDIA_TABLE_PATH or CLAIMX_DELTA_MEDIA_TABLE
    tasks_table_path: ""  # CLAIMX_TASKS_TABLE_PATH or CLAIMX_DELTA_TASKS_TABLE
    task_templates_table_path: ""  # CLAIMX_TASK_TEMPLATES_TABLE_PATH or CLAIMX_DELTA_TASK_TEMPLATES_TABLE
    external_links_table_path: ""  # CLAIMX_EXTERNAL_LINKS_TABLE_PATH or CLAIMX_DELTA_EXTERNAL_LINKS_TABLE
    video_collab_table_path: ""  # CLAIMX_VIDEO_COLLAB_TABLE_PATH or CLAIMX_DELTA_VIDEO_COLLAB_TABLE

# Local Kafka configuration (for simulation)
local_kafka:
  bootstrap_servers: ${KAFKA_BOOTSTRAP_SERVERS:-kafka:9092}
  security_protocol: ${KAFKA_SECURITY_PROTOCOL:-PLAINTEXT}
  consumer_poll_timeout_ms: 1000
  producer_max_block_ms: 60000
