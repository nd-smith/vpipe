# Simulation Mode Environment Configuration
# Copy this file to .env.simulation and customize as needed
# cp .env.simulation.example .env.simulation

# =============================================================================
# SIMULATION MODE - REQUIRED
# =============================================================================
export SIMULATION_MODE=true

# =============================================================================
# SIMULATION STORAGE
# =============================================================================
# Local filesystem paths (replaces Azure OneLake in simulation)
export SIMULATION_STORAGE_PATH=/tmp/vpipe_simulation
export SIMULATION_DELTA_PATH=/tmp/vpipe_simulation/delta
export SIMULATION_ALLOW_LOCALHOST=true
export SIMULATION_TRUNCATE_TABLES=false
export SIMULATION_DELTA_WRITE_MODE=append

# =============================================================================
# KAFKA CONNECTION - LOCAL
# =============================================================================
# Local Kafka broker (Docker) - replaces Event Hub
# Use port 9094 (EXTERNAL listener) instead of 9092 to avoid hostname resolution issues
export KAFKA_BOOTSTRAP_SERVERS=localhost:9094

# Local Kafka uses PLAINTEXT (no auth) instead of SASL_SSL for Event Hub
export KAFKA_SECURITY_PROTOCOL=PLAINTEXT

# Event Hub connection not needed in simulation
export EVENTHUB_CONNECTION_STRING=""
export KAFKA_SASL_MECHANISM=""
export KAFKA_SASL_USERNAME=""
export KAFKA_SASL_PASSWORD=""

# =============================================================================
# LOCAL DEVELOPMENT SETTINGS
# =============================================================================
# Local cache directory (from production .env)
export CACHE_DIR=/tmp/kafka_pipeline_cache

# Log level (from production .env)
export LOG_LEVEL=INFO

# =============================================================================
# CLAIMX API - NOT USED IN SIMULATION
# =============================================================================
# Simulation uses MockClaimXAPIClient with fixture data
# No API credentials needed
export CLAIMX_API_USERNAME=""
export CLAIMX_API_PASSWORD=""
export CLAIMX_API_TOKEN=""
export CLAIMX_API_BASE_PATH=""

# =============================================================================
# AZURE SERVICES - NOT USED IN SIMULATION
# =============================================================================
# Simulation uses local filesystem instead of Azure OneLake
# No Azure credentials needed
export AZURE_WORKSPACE_ID=""
export AZURE_LAKEHOUSE_ID=""
export ONELAKE_BASE_PATH=""
export EVENTHOUSE_CLUSTER_URL=""

# =============================================================================
# DELTA LAKE TABLE PATHS - LOCAL (SIMULATION)
# =============================================================================
# These are automatically set to local paths when SIMULATION_MODE=true
# based on SIMULATION_DELTA_PATH setting above
# No need to set individual table paths - they're auto-generated as:
# ${SIMULATION_DELTA_PATH}/claimx_events
# ${SIMULATION_DELTA_PATH}/claimx_attachments
# etc.

# =============================================================================
# SIMULATION FIXTURES
# =============================================================================
# Fixtures directory (defaults to kafka_pipeline/simulation/fixtures)
# export SIMULATION_FIXTURES_DIR=kafka_pipeline/simulation/fixtures

# =============================================================================
# FAILURE INJECTION - FOR RETRY TESTING
# =============================================================================
# File server failure injection (for download worker retry testing)
export FAILURE_RATE=0                     # Percentage of file download requests that fail (0-100, default: 0)
export FAILURE_DURATION_SEC=90            # How long failures last before recovering (0 = permanent, default: 90)
export FAILURE_STATUS=500                 # HTTP status code for failures (500, 503, etc., default: 500)

# ClaimX API failure injection (for enricher retry testing)
export CLAIMX_API_FAILURE_RATE=0          # Percentage of API calls that fail (0-100, default: 0)
export CLAIMX_API_FAILURE_DURATION_SEC=90 # How long failures last before recovering (0 = permanent, default: 90)
export CLAIMX_API_FAILURE_STATUS=500      # HTTP status code for failures (500, 503, etc., default: 500)

# Note: Set failure rates to 40 to test retry logic with realistic failure scenarios

# =============================================================================
# USAGE
# =============================================================================
# 1. Copy this file to .env.simulation:
#    cp .env.simulation.example .env.simulation
#
# 2. Source the file:
#    source .env.simulation
#
# 3. Start file server (optional - dummy producer starts it automatically):
#    python -m kafka_pipeline.common.dummy.file_server
#
# 4. Run dummy producer:
#    python -m kafka_pipeline.simulation.dummy_producer --domains claimx,xact --max-events 100
#
# 5. Run workers in separate terminals:
#    python -m kafka_pipeline claimx-enricher
#    python -m kafka_pipeline claimx-download
#    python -m kafka_pipeline claimx-upload
#
# For Docker Compose simulation:
#    docker-compose -f docker-compose.simulation.yml --profile simulation up -d
