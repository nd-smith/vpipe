global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # =============================================================================
  # Prometheus Self-Monitoring
  # =============================================================================
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # =============================================================================
  # OpenTelemetry Collector
  # =============================================================================
  # All workers now export metrics via OpenTelemetry SDK to the OTel Collector
  # The OTel Collector aggregates metrics and exposes them in Prometheus format
  # on port 8889 for long-term storage and Grafana visualization.
  #
  # Architecture:
  #   Workers (OTel SDK) → OTel Collector:4317 (OTLP)
  #                             ↓
  #                     OTel Collector:8889 (Prometheus format)
  #                             ↓
  #                     Prometheus scrapes here
  #                             ↓
  #                     Grafana queries Prometheus
  #
  # Metrics include domain and service.name labels automatically from OTel SDK
  # =============================================================================
  - job_name: 'otel-collector'
    static_configs:
      - targets: ['host.docker.internal:8889']
    metric_relabel_configs:
      # Preserve existing metric labels (domain, worker_type, etc.)
      # OTel SDK automatically adds service_name, service_namespace attributes
      - action: labelmap
        regex: service_(.+)
        replacement: otel_service_${1}
